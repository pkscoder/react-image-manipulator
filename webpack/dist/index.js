!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["react","react-dom"],t):"object"==typeof exports?exports.ImageManipulator=t(require("react"),require("react-dom")):e.ImageManipulator=t(e.React,e.ReactDOM)}(this,function(__WEBPACK_EXTERNAL_MODULE_1__,__WEBPACK_EXTERNAL_MODULE_2__){return function(e){function t(i){if(a[i])return a[i].exports;var o=a[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){var t=1e-6,a=1,i=0,o=0,n=1,r=e;do{var s=Math.floor(r),l=a;a=s*a+i,i=l,l=o,o=s*o+n,n=l,r=1/(r-s)}while(Math.abs(e-a/o)>e*t);return a+":"+o}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),c=a(1),u=i(c),h=a(2),d=i(h),p=a(3),f=i(p);a(!function(){var e=new Error('Cannot find module "../stylesheets/imageeditor.scss"');throw e.code="MODULE_NOT_FOUND",e}());var v={react:{down:"onMouseDown",drag:"onDragOver",drop:"onDrop",move:"onMouseMove",up:"onMouseUp"},"native":{down:"mousedown",drag:"dragStart",drop:"drop",move:"mousemove",up:"mouseup"}},m=function(e){function t(){var e,a,i,r;o(this,t);for(var s=arguments.length,l=Array(s),c=0;c<s;c++)l[c]=arguments[c];return a=i=n(this,(e=Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),i.state={height:200,width:200,scale:1.25,aspectRatio:0},r=a,n(i,r)}return r(t,e),l(t,[{key:"componentWillMount",value:function(){var e=this.props.aspectRatio||0;e&&"same"!=e||(e="1:1"),isNaN(e)||(e=s(e)),this.setState({aspectRatio:e})}},{key:"componentDidMount",value:function(){this.setState({height:d["default"].findDOMNode(imageManipulationBody).offsetHeight||200,width:d["default"].findDOMNode(imageManipulationBody).offsetWidth||200})}},{key:"handleDrop",value:function(e){if(e=e||window.event,e.stopPropagation(),e.preventDefault(),e.dataTransfer&&e.dataTransfer.files.length){var t=new FileReader,a=e.dataTransfer.files[0];t.onload=function(e){return console.log(e.target.result)},t.readAsDataURL(a)}}},{key:"handleScale",value:function(){var e=parseFloat(this.refs.scale.value);this.setState({scale:e})}},{key:"saveImage",value:function(){var e=this.refs.canvasmanipulator.getImage().toDataURL();this.props.onSave&&this.props.onSave(e)}},{key:"closePopup",value:function(){var e=this.refs.canvasmanipulator.getImage().toDataURL();this.props.onClose&&this.props.onClose(e)}},{key:"aspectRatioChanged",value:function(e){var t=e.target.value;this.setState({aspectRatio:t})}},{key:"loadComponent",value:function(){var e=this.props.className||"",t=this.props.customAspectRatio||!1,a={};return a[v.react.drop]=this.handleDrop.bind(this),u["default"].createElement("div",{className:"_outer-box "+e},u["default"].createElement("div",{className:"_box-header"},"Image Editor",u["default"].createElement("div",{className:"close-btn",onClick:this.closePopup.bind(this)})),u["default"].createElement("div",{className:"_box-body",id:"imageManipulationBody"},u["default"].createElement(f["default"],{ref:"canvasmanipulator",deviceEvents:v,height:this.state.height,width:this.state.width,aspectRatio:this.state.aspectRatio,scale:this.state.scale,color:this.props.color,image:this.props.src}),u["default"].createElement("div",{className:"image-manipulation-scale"},u["default"].createElement("input",{name:"scale",type:"range",ref:"scale",onChange:this.handleScale.bind(this),min:"1",max:"2",step:"0.01",defaultValue:this.state.scale}))),u["default"].createElement("div",{className:"_box-footer"},t?u["default"].createElement("div",null,u["default"].createElement("select",{onChange:this.aspectRatioChanged.bind(this)},u["default"].createElement("option",{value:"1:1"},"1:1"),u["default"].createElement("option",{value:"2:3"},"2:3"),u["default"].createElement("option",{value:"3:2"},"3:2"),u["default"].createElement("option",{value:"3:4"},"3:4"),u["default"].createElement("option",{value:"4:3"},"4:3"),u["default"].createElement("option",{value:"4:5"},"4:5"),u["default"].createElement("option",{value:"5:3"},"5:3"),u["default"].createElement("option",{value:"9:5"},"9:5"),u["default"].createElement("option",{value:"16:9"},"16:9"),u["default"].createElement("option",{value:"16:10"},"16:10"),u["default"].createElement("option",{value:"21:9"},"21:9"),u["default"].createElement("option",{value:"25:11"},"25:11"))):"",u["default"].createElement("div",{className:"image-crop-btn",onClick:this.saveImage.bind(this)},"CROP & SAVE")))}},{key:"render",value:function(){return u["default"].createElement("div",{className:"_react-image-manipulation"},u["default"].createElement("div",{className:"_cover-box"},this.loadComponent()))}}]),t}(u["default"].Component);m.propTypes={},m.defaultProps={color:[213,214,217,.6],src:""},t["default"]=m,e.exports=t["default"]},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_1__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_2__},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),_react=__webpack_require__(1),_react2=_interopRequireDefault(_react),_reactDom=__webpack_require__(2),_reactDom2=_interopRequireDefault(_reactDom),SIZE_PERCENT=75,Canvas=function(_React$Component){function Canvas(){var e,t,a,i;_classCallCheck(this,Canvas);for(var o=arguments.length,n=Array(o),r=0;r<o;r++)n[r]=arguments[r];return t=a=_possibleConstructorReturn(this,(e=Object.getPrototypeOf(Canvas)).call.apply(e,[this].concat(n))),a.state={drag:!1,my:null,mx:null,image:{x:0,y:0}},i=t,_possibleConstructorReturn(a,i)}return _inherits(Canvas,_React$Component),_createClass(Canvas,[{key:"componentDidMount",value:function(){var e=_reactDom2["default"].findDOMNode(this.refs.canvas).getContext("2d"),t=this.props.deviceEvents;if(this.props.image&&this.loadImage(this.props.image),this.paint(e),document){var a=t["native"];document.addEventListener(a.move,this.handleMouseMove.bind(this),!1),document.addEventListener(a.up,this.handleMouseUp.bind(this),!1)}}},{key:"componentDidUpdate",value:function(){var e=_reactDom2["default"].findDOMNode(this.refs.canvas).getContext("2d"),t=this.getDimensions();e.clearRect(0,0,t.canvas.width,t.canvas.height),this.paint(e),this.paintImage(e,this.state.image)}},{key:"componentWillReceiveProps",value:function(e){this.props.image==e.image&&this.props.aspectRatio==e.aspectRatio||this.loadImage(e.image),this.props.scale==e.scale&&this.props.height==e.height&&this.props.width==e.width||this.squeeze(e)}},{key:"squeeze",value:function(e){var t=this.state.image;t.y=this.getBoundedY(t.y,e.scale),t.x=this.getBoundedX(t.x,e.scale),this.setState({image:t})}},{key:"getDimensions",value:function getDimensions(){var parentWidth=this.props.width,parentHeight=this.props.height,aspectRatio=this.props.aspectRatio,borderVertical=void 0,borderHorizontal=void 0,height=parentHeight?parentHeight*SIZE_PERCENT/100:SIZE_PERCENT,width=parentWidth?parentWidth*SIZE_PERCENT/100:SIZE_PERCENT;return aspectRatio&&"same"!=aspectRatio||(aspectRatio="1:1"),isNaN(aspectRatio)&&(aspectRatio=eval(aspectRatio.replace(":","/"))),aspectRatio<=1?(borderVertical=(parentHeight-height)/2,borderHorizontal=(parentWidth-height*aspectRatio)/2):(borderVertical=(parentHeight-width/aspectRatio)/2,borderHorizontal=(parentWidth-width)/2),{width:parentWidth-2*borderHorizontal,height:parentHeight-2*borderVertical,borderHorizontal:borderHorizontal,borderVertical:borderVertical,canvas:{width:parentWidth,height:parentHeight}}}},{key:"paint",value:function(e){e.save(),e.translate(0,0),e.fillStyle="rgba("+this.props.color.slice(0,4).join(",")+")";var t=this.getDimensions(),a=t.canvas.height,i=t.canvas.width,o=t.borderHorizontal,n=t.borderVertical;e.beginPath(),e.rect(o,n,i-2*o,a-2*n),e.rect(i,0,-i,a),e.fill("evenodd"),e.restore()}},{key:"paintImage",value:function(e,t){if(t.resource){var a=this.calculatePosition(t);e.save(),e.globalCompositeOperation="destination-over",e.drawImage(t.resource,a.x,a.y,a.width,a.height),e.restore()}}},{key:"calculatePosition",value:function(e){e=e||this.state.image;var t=void 0,a=void 0,i=void 0,o=void 0,n=this.getDimensions();i=e.width*this.props.scale,o=e.height*this.props.scale;var r=(i-n.width)/2,s=(o-n.height)/2,l=n.borderHorizontal,c=n.borderVertical;return t=e.x*this.props.scale-r+l,a=e.y*this.props.scale-s+c,{x:t,y:a,height:o,width:i}}},{key:"handleImageReady",value:function(e){var t=this.getInitialSize(e.width,e.height);t.resource=e,t.x=0,t.y=0,this.setState({drag:!1,image:t})}},{key:"getInitialSize",value:function(e,t){var a=void 0,i=void 0,o=void 0,n=void 0,r=void 0;return o=this.getDimensions(),n=o.height/o.width,r=t/e,n>r?(a=o.height,i=e*(a/t)):(i=o.width,a=t*(i/e)),{height:a,width:i}}},{key:"loadImage",value:function(e){var t=new Image;t.onload=this.handleImageReady.bind(this,t),t.crossOrigin="anonymous",t.src=e}},{key:"handleDrop",value:function(e){var t=this;e=e||window.event,e.stopPropagation(),e.preventDefault(),e.dataTransfer&&e.dataTransfer.files.length&&!function(){var a=t,i=new FileReader,o=e.dataTransfer.files[0];i.onload=function(e){a.loadImage(e.target.result)},i.readAsDataURL(o)}()}},{key:"handleDragOver",value:function(e){e=e||window.event,e.preventDefault()}},{key:"handleMouseMove",value:function(e){if(e=e||window.event,0!=this.state.drag){var t=this.state.image,a=t.x,i=t.y,o=e.targetTouches?e.targetTouches[0].pageX:e.clientX,n=e.targetTouches?e.targetTouches[0].pageY:e.clientY,r={mx:o,my:n,image:t};if(this.state.mx&&this.state.my){var s=(this.state.mx-o)/this.props.scale,l=(this.state.my-n)/this.props.scale;t.y=this.getBoundedY(i-l,this.props.scale),t.x=this.getBoundedX(a-s,this.props.scale)}this.setState(r)}}},{key:"handleMouseDown",value:function(e){e=e||window.event,e.preventDefault(),this.setState({drag:!0,mx:null,my:null})}},{key:"handleMouseUp",value:function(){this.state.drag&&this.setState({drag:!1})}},{key:"getBoundedX",value:function(e,t){var a=this.state.image,i=this.getDimensions(),o=Math.floor((a.width-i.width/t)/2);return o=Math.max(0,o),Math.max(-o,Math.min(e,o))}},{key:"getBoundedY",value:function(e,t){var a=this.state.image,i=this.getDimensions(),o=Math.floor((a.height-i.height/t)/2);return o=Math.max(0,o),Math.max(-o,Math.min(e,o))}},{key:"getImage",value:function(){var e=this.getCroppingRect(),t=this.state.image;e.x*=t.resource.width,e.y*=t.resource.height,e.width*=t.resource.width,e.height*=t.resource.height;var a=document.createElement("canvas");return a.width=e.width,a.height=e.height,a.getContext("2d").drawImage(t.resource,-e.x,-e.y),a}},{key:"getCroppingRect",value:function(){var e=this.getDimensions(),t={x:e.borderHorizontal,y:e.borderVertical,width:e.width,height:e.height},a=this.calculatePosition(this.state.image);return{x:(t.x-a.x)/a.width,y:(t.y-a.y)/a.height,width:t.width/a.width,height:t.height/a.height}}},{key:"render",value:function(){var e=this.props.deviceEvents,t=this.getDimensions(),a={width:t.canvas.width,height:t.canvas.height,style:{cursor:"move"}};return a[e.react.down]=this.handleMouseDown.bind(this),a[e.react.drag]=this.handleDragOver.bind(this),a[e.react.drop]=this.handleDrop.bind(this),_react2["default"].createElement("canvas",_extends({ref:"canvas"},a))}}]),Canvas}(_react2["default"].Component);Canvas.defaultProps={scale:1.25},exports["default"]=Canvas,module.exports=exports["default"]}])});